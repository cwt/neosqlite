# NeoSQLite v1.3.2 Release Notes

## Overview

This is a major feature release that completes the GridFS implementation by adding all previously missing convenience methods and introducing enhanced metadata features. NeoSQLite now provides 100% PyMongo API compatibility for GridFS operations with additional enhancements like content type and aliases support. This release also includes comprehensive documentation updates and reorganization.

## New Features

### Complete GridFS API Implementation

**Added**: All missing GridFSBucket convenience methods and enhanced metadata support

#### New GridFSBucket Methods
- **`find_one(filter)`** - Direct method for single file lookup
- **`get_last_version(filename)`** - Get most recent version of a file
- **`get_version(filename, revision)`** - Get specific version of a file by revision
- **`list()`** - List all unique filenames in the GridFS bucket
- **`get(file_id)`** - Convenience alias for `open_download_stream()`

#### Enhanced Metadata Features
- **Content Type Support** - Store and query MIME types:
  ```python
  bucket.upload_from_stream("image.png", data, content_type="image/png")
  file.content_type  # Returns "image/png"
  bucket.find({"content_type": "image/png"})  # Find by content type
  ```

- **Aliases Support** - Multiple names per file with search capabilities:
  ```python
  bucket.upload_from_stream("doc.pdf", data, aliases=["document", "report"])
  file.aliases  # Returns ["document", "report"]
  bucket.find({"aliases": "document"})  # Find by alias
  ```

#### Schema Enhancements
- **Automatic Migration** - New `content_type` and `aliases` columns added seamlessly
- **JSONB Support** - Enhanced storage for aliases arrays when JSONB is available
- **Backward Compatibility** - Existing GridFS installations migrate automatically

**Before (v1.3.1)**:
```python
# Missing convenience methods
bucket.find({"filename": "test.txt"}).next()  # Workaround for find_one
# sorted(bucket.find({"filename": "test.txt"}), key=lambda f: f.upload_date, reverse=True)[0]  # Complex get_last_version workaround
# No content type or aliases support
```

**After (v1.3.2)**:
```python
# Direct methods available
bucket.find_one({"filename": "test.txt"})      # ✅ Direct method
bucket.get_last_version("test.txt")            # ✅ Direct method
bucket.list()                                  # ✅ Direct method

# Enhanced metadata
bucket.upload_from_stream("file.txt", data, content_type="text/plain", aliases=["doc", "important"])
bucket.find({"content_type": "text/plain"})    # ✅ Search by content type
bucket.find({"aliases": "doc"})                # ✅ Search by alias
```

## Documentation Updates

### Major Documentation Reorganization

**Reorganized**: Documentation structure for better organization and maintenance

#### New Documentation Files
- **`documents/GRIDFS.md`** - Comprehensive GridFS documentation combining all GridFS-related information
- **`documents/ANALYSIS_SUMMARY.md`** - Moved from TODO directory (completed analysis)

#### Updated Documentation Files
- **`README.md`** - Enhanced GridFS examples showing new content_type and aliases features
- **`documents/PyMongo_API_Comparison.md`** - Updated with complete GridFS feature list
- **`documents/TODO/API_COMPATIBILITY_REPORT.md`** - Enhanced with current GridFS status

#### Removed Outdated Files
- **`documents/GRIDFS_MISSING_FEATURES.md`** - Features now implemented
- **`documents/GRIDFS_MIGRATION.md`** - Content merged into GRIDFS.md
- **`documents/TODO/ANALYSIS_SUMMARY.md`** - Moved to main documents

### Enhanced Examples and Guides

- **Comprehensive GridFS Examples** - Updated README with practical examples of all new features
- **Migration Guides** - Complete PyMongo to NeoSQLite migration examples
- **API Compatibility Matrix** - Updated with 100% GridFS compatibility status
- **Best Practices** - Clear guidance on when to use different GridFS APIs

## Bug Fixes

### GridFS Schema Migration
- **Fixed**: Automatic addition of new `content_type` and `aliases` columns to existing databases
- **Fixed**: Proper JSONB migration for aliases arrays when supported
- **Fixed**: Backward compatibility maintained for databases created with older versions

### Collection Access Improvements
- **Enhanced**: Better error handling for GridFS collection operations
- **Fixed**: Improved delegation logic for complex queries involving new metadata fields

## Known Limitations

### GridFS Enhanced Features

As of v1.3.2, all core GridFS functionality is complete with enhanced metadata support. Some advanced features remain:

1. **Complex Alias Queries** - Multi-alias matching uses JSON array operations (may have performance implications for very large datasets)

2. **Content Type Validation** - MIME type strings are stored as-provided (no validation against actual file content)

3. **Migration Performance** - Large existing GridFS installations may experience brief delays during first access after upgrade

## Working Operations

The following GridFS operations work with full PyMongo compatibility:

### Core GridFSBucket Operations
```python
# All methods now available with 100% PyMongo compatibility
bucket.upload_from_stream("file.txt", data, content_type="text/plain", aliases=["doc"])
bucket.find_one({"filename": "file.txt"})      # ✅ Direct method
bucket.get_last_version("file.txt")           # ✅ Direct method
bucket.get_version("file.txt", revision=1)    # ✅ Direct method
bucket.list()                                 # ✅ Direct method ["file.txt"]
bucket.get(file_id)                           # ✅ Direct method

# Enhanced querying
bucket.find({"content_type": "text/plain"})   # ✅ Content type search
bucket.find({"aliases": "doc"})               # ✅ Alias search
```

### Collection Access Operations
```python
# PyMongo-style collection access with auto-delegation
conn.fs.files.find({"filename": "test.txt"})           # ✅ Works
conn.fs.files.find_one({"aliases": "document"})        # ✅ Works
conn.fs.files.delete_one({"_id": file_id})              # ✅ Works
conn.fs.files.update_one({"_id": file_id}, {"$set": {"metadata": {"updated": True}}})  # ✅ Works
```

### Legacy GridFS API
```python
# Legacy API also enhanced
fs = GridFS(conn.db)
fs.get_last_version("filename")  # ✅ Enhanced with new features
fs.list()                       # ✅ Enhanced with new features
```

## Documentation Updates

### Updated Files
- **`README.md`**: Enhanced GridFS examples, updated feature descriptions
- **`documents/GRIDFS.md`**: New comprehensive GridFS documentation
- **`documents/PyMongo_API_Comparison.md`**: Complete GridFS feature documentation
- **`documents/TODO/`**: Updated planning documents reflecting current status

### New Files
- **`documents/GRIDFS.md`**: Unified comprehensive GridFS documentation
- **`documents/ANALYSIS_SUMMARY.md`**: Completed analysis documentation

### Removed Files
- **`documents/GRIDFS_MISSING_FEATURES.md`**: Superseded by implementation
- **`documents/GRIDFS_MIGRATION.md`**: Merged into GRIDFS.md
- **`documents/TODO/ANALYSIS_SUMMARY.md`**: Moved to main documents

## Installation

```bash
# Standard installation
pip install neosqlite==1.3.2

# For enhanced JSON/JSONB support
pip install neosqlite[jsonb]==1.3.2

# For memory-constrained processing of large result sets
pip install neosqlite[memory-constrained]==1.3.2

# Install multiple extras
pip install neosqlite[jsonb,memory-constrained]==1.3.2
```

## Upgrade Notes

### From v1.3.1

This release adds significant new functionality while maintaining full backward compatibility:

**New capabilities in v1.3.2:**
- `GridFSBucket.find_one()` - Direct single file lookup
- `GridFSBucket.get_last_version()` - Get latest file version
- `GridFSBucket.get_version()` - Get specific file version
- `GridFSBucket.list()` - List all filenames
- `GridFSBucket.get()` - Convenience file access
- Content type support in all upload methods
- Aliases support with search capabilities

**GridFS functionality** is fully enhanced with automatic schema migration for existing installations.

### Schema Migration

Existing GridFS installations will automatically migrate when first accessed:
- New `content_type` column added (TEXT)
- New `aliases` column added (TEXT/JSONB)
- No data loss or manual intervention required

## Testing

### New Test Cases Added

- **GridFSBucket Methods**: Comprehensive tests for all new convenience methods
- **Content Type Support**: Full test coverage for MIME type storage and querying
- **Aliases Support**: Complete test suite for alias functionality and search
- **Schema Migration**: Tests for automatic column addition and data migration
- **Enhanced Examples**: Updated documentation examples with real functionality

### Compatibility Testing

- **Backward Compatibility**: All existing code continues to work unchanged
- **API Compatibility**: 100% PyMongo GridFS API compatibility achieved
- **Migration Testing**: Automatic schema upgrades tested across versions

## Compatibility

- **Backward Compatible**: All existing code continues to work unchanged
- **API Stability**: GridFS API enhanced with full compatibility maintained
- **Schema Migration**: Seamless upgrades for existing GridFS installations
- **Enhanced Features**: New content_type and aliases features are optional

## Future Enhancements

Future releases may add:
- Advanced content type validation
- Alias relationship management
- Bulk GridFS operations
- Enhanced performance optimizations for large GridFS installations</content>
<parameter name="filePath">documents/releases/v1.3.2.md